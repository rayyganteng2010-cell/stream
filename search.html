<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cari Anime - RAYSTREAM</title>
    <style>
        :root { --bg: #050505; --card: #141414; --primary: #06b6d4; --text: #fff; }
        body { margin:0; font-family:'Segoe UI', sans-serif; background:var(--bg); color:var(--text); padding-bottom:80px; }
        
        /* Search Bar Sticky */
        .search-area { padding:15px 20px; position:sticky; top:0; background:rgba(5,5,5,0.9); backdrop-filter:blur(15px); z-index:100; border-bottom:1px solid #222; }
        .input-group { position:relative; display:flex; align-items:center; }
        .input-group svg { position:absolute; left:15px; color:#888; width:18px; height:18px; }
        input { width:100%; box-sizing:border-box; padding:12px 15px 12px 45px; border-radius:50px; border:1px solid #333; background:#1a1a1a; color:#fff; outline:none; font-size:14px; transition:0.3s; }
        input:focus { border-color:var(--primary); box-shadow:0 0 15px rgba(6, 182, 212, 0.2); background:#222; }

        /* Grid Result */
        .grid { display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; padding:20px 15px; }
        .card { cursor:pointer; position:relative; transition:0.2s; }
        .card:active { transform:scale(0.96); opacity:0.8; }
        .card img { width:100%; aspect-ratio:3/4.5; border-radius:8px; object-fit:cover; background:#222; box-shadow:0 4px 10px rgba(0,0,0,0.3); }
        .type-badge { position:absolute; top:6px; right:6px; background:rgba(0,0,0,0.7); color:var(--primary); font-size:9px; font-weight:800; padding:3px 6px; border-radius:4px; backdrop-filter:blur(4px); border:1px solid rgba(6, 182, 212, 0.3); }
        .c-title { font-size:11px; margin-top:8px; color:#ddd; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; line-height:1.3; font-weight:500; }

        /* Pesan Kosong/Loading */
        .status-msg { text-align:center; padding:50px 20px; color:#666; font-size:13px; }

        /* NAV */
        .nav { position:fixed; bottom:0; width:100%; background:rgba(5,5,5,0.95); backdrop-filter:blur(10px); border-top:1px solid #222; display:flex; height:65px; align-items:center; justify-content:space-around; z-index:100; }
        .nav a { color:#666; text-decoration:none; font-size:10px; display:flex; flex-direction:column; align-items:center; gap:4px; font-weight:500; }
        .nav a.active { color:var(--primary); }
        .nav svg { width:22px; height:22px; fill:currentColor; }
        .nav a.active svg { filter:drop-shadow(0 0 8px rgba(6, 182, 212, 0.5)); transform:translateY(-2px); }
    </style>
</head>
<body>

<div class="search-area">
    <div class="input-group">
        <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/></svg>
        <input type="text" id="q" placeholder="Cari donghua favoritmu..." onkeyup="if(event.key==='Enter') doSearch()">
    </div>
</div>

<div id="resultGrid" class="grid"></div>
<div id="msg" class="status-msg">Silakan ketik judul lalu tekan Enter.</div>

<div class="nav">
    <a href="index.html"><svg><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</a>
    <a href="schedule.html"><svg><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>Jadwal</a>
    <a href="search.html" class="active"><svg><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>Cari</a>
</div>

<script src="config.js"></script>
<script>
    // Login Check Otomatis dari config.js

    async function doSearch() {
        const q = document.getElementById('q').value;
        if(!q) return;
        
        const grid = document.getElementById('resultGrid');
        const msg = document.getElementById('msg');
        
        // Reset UI
        grid.innerHTML = "";
        msg.innerHTML = "Sedang mencari...";
        msg.style.display = "block";
        document.getElementById('q').blur(); // Tutup keyboard di HP

        try {
            const res = await fetch(API_BASE + '/api/search?s=' + encodeURIComponent(q));
            const json = await res.json();
            const data = json.data || [];
            
            if(!data || data.length === 0) {
                msg.innerHTML = "Tidak ditemukan hasil untuk: <b>" + q + "</b>";
                return;
            }

            msg.style.display = "none";

            data.forEach(item => {
                // Handling variasi nama property dari API (thumbnail/poster, anichinUrl/url)
                const img = item.thumbnail || item.poster;
                const link = item.anichinUrl || item.url;
                const type = item.type || item.status || 'DONGHUA';

                grid.innerHTML += `
                <div class="card" onclick="window.location.href='detail.html?url=${encodeURIComponent(link)}'">
                    <img src="${img}" loading="lazy">
                    <div class="type-badge">${type}</div>
                    <div class="c-title">${item.title}</div>
                </div>`;
            });

        } catch(e) {
            console.error(e);
            msg.innerHTML = "Terjadi kesalahan saat memuat data.";
        }
    }
</script>
</body>
</html>
