<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Anime</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

<header style="background:transparent; position:absolute; border:none;">
    <div class="logo" onclick="history.back()" style="background:rgba(0,0,0,0.5); padding:5px 10px; border-radius:50%;">
        <i data-lucide="arrow-left" style="color:white;"></i>
    </div>
</header>

<div style="position:relative; height:300px;">
    <img id="heroImg" src="" style="width:100%; height:100%; object-fit:cover; opacity:0.6;">
    <div style="position:absolute; bottom:0; left:0; width:100%; background:linear-gradient(to top, var(--bg-main), transparent); height:150px;"></div>
    
    <div style="position:absolute; bottom:20px; left:20px; right:20px; display:flex; align-items:flex-end; gap:15px;">
        <img id="posterImg" src="" style="width:100px; border-radius:8px; box-shadow:0 5px 15px rgba(0,0,0,0.5);">
        <div>
            <h2 id="title" style="margin:0; font-size:1.2rem; line-height:1.2; text-shadow:2px 2px 4px black;">Loading...</h2>
            <p id="meta" style="font-size:0.8rem; color:#ccc; margin-top:5px;"></p>
        </div>
    </div>
</div>

<div style="padding:20px;">
    <div id="genres" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px;"></div>
    
    <div style="background:var(--bg-card); padding:15px; border-radius:var(--radius); margin-bottom:20px;">
        <h4 style="margin:0 0 10px 0;">Sinopsis</h4>
        <p id="synopsis" style="font-size:0.85rem; color:#aaa; line-height:1.6; margin:0;">...</p>
    </div>

    <h3 style="margin-bottom:15px;">Episodes</h3>
    <div id="epsGrid" class="grid" style="grid-template-columns: repeat(4, 1fr); padding:0;"></div>
</div>

<script>
    const API_BASE = "https://anichin-seven.vercel.app/api";
    const urlParams = new URLSearchParams(window.location.search);
    const seriesUrl = urlParams.get('url');

    async function loadSeries() {
        if(!seriesUrl) return;
        try {
            const res = await fetch(`${API_BASE}/series?url=${seriesUrl}`);
            const json = await res.json();

            // Populate Data
            document.getElementById('title').innerText = json.title;
            document.getElementById('meta').innerText = `${json.info.status} â€¢ ${json.info.type}`;
            document.getElementById('heroImg').src = json.poster;
            document.getElementById('posterImg').src = json.poster;
            document.getElementById('synopsis').innerText = json.short_description || json.synopsis;

            // Genres
            document.getElementById('genres').innerHTML = json.genres.map(g => 
                `<span style="background:var(--bg-element); padding:4px 10px; border-radius:20px; font-size:0.7rem;">${g.name}</span>`
            ).join('');

            // Episode Grid
            document.getElementById('epsGrid').innerHTML = json.episodes_list.map(ep => {
                const num = ep.episode.match(/Episode\s+(\d+)/i)?.[1] || "Ep";
                return `<button class="btn" style="background:var(--bg-element);" onclick="window.location.href='stream.html?url=${ep.anichinUrl}'">${num}</button>`;
            }).join('');

            lucide.createIcons();
        } catch(e) { console.log(e); }
    }
    loadSeries();
</script>
</body>
</html>
