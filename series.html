<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Anime</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="logo" onclick="history.back()" style="cursor:pointer;">&larr; BACK</div>
    <div class="logo">ANICHIN</div>
</header>

<div id="loading" style="text-align:center; padding:20px;">Loading Series...</div>

<div id="seriesContainer" style="display:none;">
    <div style="position:relative;">
        <img id="poster" src="" style="width:100%; height:250px; object-fit:cover; opacity:0.3; position:absolute; z-index:-1;">
        <div style="padding:20px; display:flex; gap:15px; align-items:flex-end; padding-top:100px; background: linear-gradient(to bottom, transparent, #121212);">
            <img id="posterFront" src="" style="width:100px; border-radius:5px; box-shadow: 0 0 10px black;">
            <div>
                <h2 id="title" style="margin:0; font-size:1.2rem;">Title</h2>
                <p id="status" style="margin:5px 0; color:var(--primary); font-size:0.8rem;">Ongoing</p>
            </div>
        </div>
    </div>

    <div style="padding:15px;">
        <div id="genres" style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:15px;"></div>
        
        <div style="background:#1e1e1e; padding:10px; border-radius:5px; font-size:0.85rem; color:#ccc; margin-bottom:15px;">
            <p id="synopsis" style="margin:0; line-height:1.5;">...</p>
        </div>

        <h3>All Episodes</h3>
        <div id="epsList" class="eps-grid" style="grid-template-columns: repeat(4, 1fr);"></div>
    </div>
</div>

<nav class="bottom-nav">
    <a href="index.html" class="nav-item">Home</a>
    <a href="schedule.html" class="nav-item">Jadwal</a>
    <a href="history.html" class="nav-item">History</a>
</nav>

<script>
    const API_BASE = "https://anichin-seven.vercel.app/api";
    const urlParams = new URLSearchParams(window.location.search);
    const seriesUrl = urlParams.get('url');

    async function loadSeries() {
        if(!seriesUrl) return alert("URL Error");
        
        try {
            // Panggil API Series
            const res = await fetch(`${API_BASE}/series?url=${seriesUrl}`);
            const json = await res.json();
            
            // Render Info Utama
            document.getElementById('title').innerText = json.title;
            document.getElementById('status').innerText = json.info.status;
            document.getElementById('poster').src = json.poster;
            document.getElementById('posterFront').src = json.poster;
            document.getElementById('synopsis').innerText = json.short_description || json.synopsis;

            // Render Genre
            const genreContainer = document.getElementById('genres');
            genreContainer.innerHTML = json.genres.map(g => 
                `<span style="background:#333; padding:2px 8px; border-radius:4px; font-size:0.7rem;">${g.name}</span>`
            ).join('');

            // Render Episode List (Dari API Series ini datanya lengkap)
            const epsContainer = document.getElementById('epsList');
            // Kita reverse biar episode terbaru di atas (opsional, tergantung selera)
            // json.episodes_list biasanya urut dari baru ke lama
            
            epsContainer.innerHTML = json.episodes_list.map(ep => {
                // Ambil nomor episode dari string (misal: "Renegade Immortal Episode 124...")
                // Regex sederhana untuk ambil angka setelah kata Episode
                const epNum = ep.episode.match(/Episode\s+(\d+)/i) ? ep.episode.match(/Episode\s+(\d+)/i)[1] : ep.episode;
                
                return `<button class="eps-btn" onclick="goToStream('${ep.anichinUrl}')">${epNum}</button>`;
            }).join('');

            document.getElementById('loading').style.display = 'none';
            document.getElementById('seriesContainer').style.display = 'block';

        } catch (e) {
            console.error(e);
            document.getElementById('loading').innerText = "Gagal memuat data.";
        }
    }

    function goToStream(url) {
        window.location.href = `stream.html?url=${url}`;
    }

    loadSeries();
</script>
</body>
</html>
