<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genre Anime - RayStream</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Menggunakan style yang sama persis dengan anime.html untuk konsistensi */
        :root {
            --primary: #f59e0b;
            --bg-dark: #0f172a;
            --text-main: #f8fafc;
        }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: 'Inter', sans-serif; margin: 0; padding-bottom: 20px; }
        
        header {
            position: sticky; top: 0; z-index: 50;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 16px;
            display: flex; align-items: center; gap: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        h1 { font-size: 1.1rem; margin: 0; font-weight: 700; text-transform: capitalize; }
        
        .container { padding: 20px 16px; }
        
        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); 
            gap: 12px;
        }

        .card { cursor: pointer; }
        .card-poster {
            width: 100%; aspect-ratio: 2/3; object-fit: cover;
            border-radius: 8px; background: #1e293b;
        }
        .card-title {
            font-size: 0.85rem; font-weight: 600; margin-top: 6px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }

        .loading { text-align: center; margin-top: 50px; color: gray; }
    </style>
</head>
<body>

<header>
    <i data-lucide="arrow-left" onclick="history.back()" style="cursor:pointer"></i>
    <h1 id="pageTitle">Memuat...</h1>
</header>

<div class="container">
    <div id="animeGrid" class="grid-cards">
        <div class="loading">Mengambil data...</div>
    </div>
</div>

<script>
    const API_BASE = "https://donghua-qnha.vercel.app/anime/samehadaku";

    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        
        // Ambil parameter dari URL (contoh: ?id=action&name=Action)
        const urlParams = new URLSearchParams(window.location.search);
        const genreId = urlParams.get('id');
        const genreName = urlParams.get('name');

        if (!genreId) {
            document.getElementById('animeGrid').innerHTML = "Genre tidak valid.";
            return;
        }

        // Set judul halaman
        document.getElementById('pageTitle').textContent = `Genre: ${genreName || genreId}`;
        
        loadGenreData(genreId);
    });

    async function loadGenreData(genreId) {
        try {
            // Request ke endpoint genre
            // Note: Endpoint pagination biasanya ?page=1, disini kita load page 1 default
            const res = await fetch(`${API_BASE}/genres/${genreId}?page=1`);
            const json = await res.json();
            const container = document.getElementById('animeGrid');

            let items = [];
            if (json.data && json.data.animeList) {
                items = json.data.animeList;
            }

            if (items.length === 0) {
                container.innerHTML = '<div style="grid-column:1/-1; text-align:center;">Tidak ada anime ditemukan untuk genre ini.</div>';
                return;
            }

            container.innerHTML = '';
            items.forEach(item => {
                // Extract slug
                let slug = item.animeId;
                if (!slug && item.href) slug = item.href.split('/').filter(Boolean).pop();

                const poster = item.poster || item.image || 'https://via.placeholder.com/150x225';
                const title = item.title;
                const score = item.score ? `â­${item.score}` : '';

                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => window.location.href = `series.html?slug=${slug}&source=anime`;
                
                div.innerHTML = `
                    <div style="position:relative;">
                        <img src="${poster}" class="card-poster" loading="lazy">
                        ${score ? `<span style="position:absolute; top:5px; right:5px; background:rgba(0,0,0,0.7); color:#fbbf24; font-size:0.7rem; padding:2px 5px; border-radius:4px; font-weight:bold;">${score}</span>` : ''}
                    </div>
                    <div class="card-title">${title}</div>
                `;
                container.appendChild(div);
            });

        } catch (e) {
            console.error(e);
            document.getElementById('animeGrid').innerHTML = '<div style="color:red; text-align:center;">Gagal memuat data genre.</div>';
        }
    }
</script>

</body>
</html>
